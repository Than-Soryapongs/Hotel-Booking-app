# Forgot Password - Complete Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FORGOT PASSWORD FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: REQUEST PASSWORD RESET
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User  â”‚  "I forgot my password"
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚
       â”‚ Goes to login page
       â”‚
       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Login Page     â”‚
   â”‚ [Forgot Pass?] â”‚â”€â”€â”€â” Clicks "Forgot Password?"
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                        â”‚
                        â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Enter Email Page â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Enters: user@example.com
                           â”‚
                           â–¼
                  POST /api/auth/forgot-password
                  { "email": "user@example.com" }
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  AuthService   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”œâ”€â–º 1. Find user by email
                           â”‚   â””â”€â–º âœ“ User exists
                           â”‚
                           â”œâ”€â–º 2. Generate secure token
                           â”‚   â””â”€â–º Token: "abc123xyz..."
                           â”‚
                           â”œâ”€â–º 3. Set expiration (1 hour)
                           â”‚   â””â”€â–º Expires at: 2025-10-14 15:30:00
                           â”‚
                           â”œâ”€â–º 4. Save to database
                           â”‚   â”œâ”€â–º passwordResetToken = "abc123xyz..."
                           â”‚   â””â”€â–º passwordResetTokenExpiresAt = 2025-10-14 15:30:00
                           â”‚
                           â”œâ”€â–º 5. Send email via EmailService
                           â”‚   â””â”€â–º To: user@example.com
                           â”‚
                           â–¼
                  Response: {
                    "message": "Password reset instructions sent",
                    "email": "user@example.com"
                  }
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Success Page   â”‚
                  â”‚ "Check email!" â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 2: EMAIL DELIVERY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   SendGrid     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Sends HTML email
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    User's Email Inbox      â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚ From: Hotel Booking        â”‚
                  â”‚ Subject: Reset Your Pass   â”‚
                  â”‚                            â”‚
                  â”‚ Hello johndoe!             â”‚
                  â”‚                            â”‚
                  â”‚ Click to reset:            â”‚
                  â”‚ [Reset Password Button]    â”‚
                  â”‚                            â”‚
                  â”‚ Link expires in 1 hour     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 3: USER CLICKS EMAIL LINK
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User  â”‚ Clicks reset button
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚
       â”‚ Opens link: 
       â”‚ http://frontend.com/reset-password?token=abc123xyz...
       â”‚
       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Reset Password Page  â”‚
   â”‚                      â”‚
   â”‚ Enter new password:  â”‚
   â”‚ [_______________]    â”‚
   â”‚                      â”‚
   â”‚ Confirm password:    â”‚
   â”‚ [_______________]    â”‚
   â”‚                      â”‚
   â”‚ [Reset Password]     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ User enters: newSecure123
              â”‚
              â–¼
   POST /api/auth/reset-password
   {
     "token": "abc123xyz...",
     "newPassword": "newSecure123"
   }


STEP 4: PASSWORD RESET PROCESSING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  AuthService   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”œâ”€â–º 1. Find user by token
                       â”‚   â””â”€â–º SELECT * FROM users 
                       â”‚       WHERE passwordResetToken = 'abc123xyz...'
                       â”‚
                       â”œâ”€â–º 2. Check token expiration
                       â”‚   â”œâ”€â–º Current time: 2025-10-14 14:45:00
                       â”‚   â”œâ”€â–º Expires at:   2025-10-14 15:30:00
                       â”‚   â””â”€â–º âœ“ Valid (not expired)
                       â”‚
                       â”œâ”€â–º 3. Hash new password
                       â”‚   â””â”€â–º BCrypt hash: $2a$10$N9q...
                       â”‚
                       â”œâ”€â–º 4. Update database
                       â”‚   â”œâ”€â–º password = $2a$10$N9q...
                       â”‚   â”œâ”€â–º passwordResetToken = NULL
                       â”‚   â”œâ”€â–º passwordResetTokenExpiresAt = NULL
                       â”‚   â”œâ”€â–º failedLoginAttempts = 0
                       â”‚   â””â”€â–º lockedUntil = NULL
                       â”‚
                       â–¼
              Response: {
                "message": "Password reset successfully",
                "username": "johndoe"
              }
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Success Page   â”‚
              â”‚ "Password      â”‚
              â”‚  changed!"     â”‚
              â”‚                â”‚
              â”‚ [Go to Login]  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 5: USER LOGS IN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User  â”‚ Goes to login page
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚
       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Login Page    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Enters:
            â”‚ - Username: johndoe
            â”‚ - Password: newSecure123
            â”‚
            â–¼
   POST /api/auth/login
   {
     "usernameOrEmail": "johndoe",
     "password": "newSecure123"
   }
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  AuthService   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€â–º 1. Find user
            â”œâ”€â–º 2. Check if enabled
            â”œâ”€â–º 3. Check if locked
            â”œâ”€â–º 4. Verify password âœ“
            â”œâ”€â–º 5. Generate JWT tokens
            â””â”€â–º 6. Update last login
            â”‚
            â–¼
   Response: {
     "accessToken": "eyJhbG...",
     "refreshToken": "eyJhbG...",
     "user": { ... }
   }
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Dashboard Page â”‚
   â”‚ "Welcome back!"â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ERROR SCENARIOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ Email Not Found
   POST /api/auth/forgot-password
   { "email": "notfound@example.com" }
   â”‚
   â””â”€â–º Error: "User not found with this email address"


âŒ Invalid Token
   POST /api/auth/reset-password
   { "token": "invalid-token", "newPassword": "..." }
   â”‚
   â””â”€â–º Error: "Invalid password reset token"


âŒ Expired Token
   POST /api/auth/reset-password
   { "token": "expired-token", "newPassword": "..." }
   â”‚
   â”œâ”€â–º Current time: 2025-10-14 16:00:00
   â”œâ”€â–º Token expires: 2025-10-14 15:30:00
   â””â”€â–º Error: "Password reset token has expired. Please request a new one."


âŒ Weak Password
   POST /api/auth/reset-password
   { "token": "valid-token", "newPassword": "123" }
   â”‚
   â””â”€â–º Error: "Password must be at least 6 characters"


DATABASE STATE CHANGES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

BEFORE REQUEST:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Table                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ email        â”‚ password    â”‚ resetToken   â”‚ resetExpiry â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user@ex.com  â”‚ $2a$10$Abc â”‚ NULL         â”‚ NULL        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER FORGOT PASSWORD:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Table                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ email        â”‚ password    â”‚ resetToken   â”‚ resetExpiry          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user@ex.com  â”‚ $2a$10$Abc â”‚ abc123xyz... â”‚ 2025-10-14 15:30:00  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER RESET PASSWORD:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Table                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ email        â”‚ password    â”‚ resetToken   â”‚ resetExpiry â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user@ex.com  â”‚ $2a$10$Xyz â”‚ NULL         â”‚ NULL        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†‘ NEW PASSWORD


SECURITY HIGHLIGHTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”’ Token is 32-byte SecureRandom (256 bits of entropy)
ğŸ”’ Token expires in 1 hour (3600 seconds)
ğŸ”’ Token is single-use (cleared after reset)
ğŸ”’ Password hashed with BCrypt (cost factor 10)
ğŸ”’ Failed login attempts reset on password change
ğŸ”’ Account unlocked on password change
ğŸ”’ No authentication required for public endpoints
ğŸ”’ Email ownership verified (link sent to user's email)
```
